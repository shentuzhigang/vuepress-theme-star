"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[8063],{77524:(n,s,e)=>{e.r(s),e.d(s,{data:()=>a});const a={key:"v-704a9118",path:"/zh/vuepress-next/advanced/cookbook/usage-of-client-app-enhance.html",title:"Client App Enhance 的使用方法",lang:"zh-CN",frontmatter:{},excerpt:"",headers:[{level:2,title:"注册 Vue 组件",slug:"注册-vue-组件",children:[]},{level:2,title:"使用不支持 SSR 的功能",slug:"使用不支持-ssr-的功能",children:[]},{level:2,title:"使用 Router 方法",slug:"使用-router-方法",children:[]}],git:{updatedTime:1635758933e3,contributors:[{name:"shentuzhigang",email:"shentuzhigang@moresec.cn",commits:1}]},readingTime:{minutes:2.06,words:617},filePathRelative:"zh/vuepress-next/advanced/cookbook/usage-of-client-app-enhance.md",content:"# Client App Enhance 的使用方法\n\n插件 API 提供的 [clientAppEnhanceFiles](../../reference/plugin-api.md#clientappenhancefiles) Hook 允许你设置 Client App Enhance 文件的路径。你可以在你的插件或者主题中使用它：\n\n```ts\nimport { path } from '@vuepress/utils'\n\nconst pluginOrTheme = {\n  clientAppEnhanceFiles: path.resolve(__dirname, './path/to/clientAppEnhance.ts'),\n}\n```\n\n然后，创建 `clientAppEnhance.ts` 文件。你可以使用 [defineClientAppEnhance](../../reference/client-api.md#defineclientappenhance) Helper 来获取类型提示。注意这个函数既可以是同步的，也可以是异步的。\n\n```ts\nimport { defineClientAppEnhance } from '@vuepress/client'\n\nexport default defineClientAppEnhance(({ app, router, siteData }) => {\n  // ...\n})\n```\n\n- `app` 是由 [createApp](https://v3.cn.vuejs.org/api/application-api.html) 创建的 Vue 应用实例。\n- `router` 是由 [createRouter](https://next.router.vuejs.org/zh/api/index.html#createrouter) 创建的路由实例。\n- `siteData` 是一个根据用户配置生成的对象，包含 [base](../../reference/config.md#base), [lang](../../reference/config.md#lang), [title](../../reference/config.md#title), [description](../../reference/config.md#description), [head](../../reference/config.md#head) 和 [locales](../../reference/config.md#locales)。\n\nClient App Enhance 会在客户端应用创建后被调用，它可以为 Vue 应用添加任意功能。\n\n::: tip\n为了方便用户配置使用， `.vuepress/clientAppEnhance.{js,ts}` 文件会被隐式地用作 Client App Enhance 文件，除非你在配置文件中显式设置了 `clientAppEnhanceFiles` 。\n:::\n\n## 注册 Vue 组件\n\n你可以通过 [component](https://v3.cn.vuejs.org/api/application-api.html#component) 方法来注册 Vue 全局组件：\n\n```ts\nimport { defineClientAppEnhance } from '@vuepress/client'\nimport MyComponent from './MyComponent.vue'\n\nexport default defineClientAppEnhance(({ app, router, siteData }) => {\n  app.component('MyComponent', MyComponent)\n})\n```\n\n## 使用不支持 SSR 的功能\n\nVuePress 会在构建过程中生成一个 SSR 应用，用以对页面进行预渲染。一般而言，如果一段代码在客户端应用 Mount 之前就使用了浏览器或 DOM API ，我们就认为其对 SSR 不友好，即不支持 SSR 。\n\n我们已经提供了一个 [ClientOnly](../../reference/components.md#clientonly) 组件来包裹不支持 SSR 的内容。\n\n在 Client App Enhance 文件中，你可以使用 [`__VUEPRESS_SSR__`](../../reference/client-api.md#ssr) 标记来处理这种情况。\n\n```ts\nimport { defineClientAppEnhance } from '@vuepress/client'\n\nexport default defineClientAppEnhance(async ({ app, router, siteData }) => {\n  if (!__VUEPRESS_SSR__) {\n    const nonSsrFriendlyModule = await import('non-ssr-friendly-module')\n    // ...\n  }\n})\n```\n\n## 使用 Router 方法\n\n你可以使用 vue-router 提供的 [Router 方法](https://next.router.vuejs.org/zh/api/index.html#router-方法) 。例如，添加导航钩子：\n\n```ts\nimport { defineClientAppEnhance } from '@vuepress/client'\n\nexport default defineClientAppEnhance(({ app, router, siteData }) => {\n  router.beforeEach((to) => {\n    console.log('before navigation')\n  })\n\n  router.afterEach((to) => {\n    console.log('after navigation')\n  })\n})\n```\n\n::: warning\n我们不推荐使用 `addRoute` 方法来添加动态路由，因为这些路由记录 **不会** 在构建模式中被预渲染出来。\n\n当然，如果你了解了这种用法的缺点，你还是可以这样使用。\n:::\n"}},81980:(n,s,e)=>{e.r(s),e.d(s,{default:()=>I});var a=e(66252);const p=(0,a._)("h1",{id:"client-app-enhance-的使用方法",tabindex:"-1"},[(0,a._)("a",{class:"header-anchor",href:"#client-app-enhance-的使用方法","aria-hidden":"true"},"#"),(0,a.Uk)(" Client App Enhance 的使用方法")],-1),l=(0,a.Uk)("插件 API 提供的 "),o=(0,a.Uk)("clientAppEnhanceFiles"),t=(0,a.Uk)(" Hook 允许你设置 Client App Enhance 文件的路径。你可以在你的插件或者主题中使用它："),r=(0,a.uE)('<div class="language-typescript ext-ts line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> { </span><span style="color:#9CDCFE;">path</span><span style="color:#D4D4D4;"> } </span><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;@vuepress/utils&#39;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> </span><span style="color:#4FC1FF;">pluginOrTheme</span><span style="color:#D4D4D4;"> = {</span></span>\n<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">clientAppEnhanceFiles:</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">path</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">resolve</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">__dirname</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;./path/to/clientAppEnhance.ts&#39;</span><span style="color:#D4D4D4;">),</span></span>\n<span class="line"><span style="color:#D4D4D4;">}</span></span>\n<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div>',1),c=(0,a.Uk)("然后，创建 "),i=(0,a._)("code",null,"clientAppEnhance.ts",-1),D=(0,a.Uk)(" 文件。你可以使用 "),u=(0,a.Uk)("defineClientAppEnhance"),y=(0,a.Uk)(" Helper 来获取类型提示。注意这个函数既可以是同步的，也可以是异步的。"),C=(0,a.uE)('<div class="language-typescript ext-ts line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> { </span><span style="color:#9CDCFE;">defineClientAppEnhance</span><span style="color:#D4D4D4;"> } </span><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;@vuepress/client&#39;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#C586C0;">export</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">default</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">defineClientAppEnhance</span><span style="color:#D4D4D4;">(({ </span><span style="color:#9CDCFE;">app</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">router</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">siteData</span><span style="color:#D4D4D4;"> }) </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span>\n<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#6A9955;">// ...</span></span>\n<span class="line"><span style="color:#D4D4D4;">})</span></span>\n<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div>',1),d=(0,a._)("li",null,[(0,a._)("code",null,"app"),(0,a.Uk)(" 是由 "),(0,a._)("a",{href:"https://v3.cn.vuejs.org/api/application-api.html",target:"_blank",rel:"noopener noreferrer"},"createApp"),(0,a.Uk)(" 创建的 Vue 应用实例。")],-1),h=(0,a._)("li",null,[(0,a._)("code",null,"router"),(0,a.Uk)(" 是由 "),(0,a._)("a",{href:"https://next.router.vuejs.org/zh/api/index.html#createrouter",target:"_blank",rel:"noopener noreferrer"},"createRouter"),(0,a.Uk)(" 创建的路由实例。")],-1),m=(0,a._)("code",null,"siteData",-1),f=(0,a.Uk)(" 是一个根据用户配置生成的对象，包含 "),E=(0,a.Uk)("base"),b=(0,a.Uk)(", "),v=(0,a.Uk)("lang"),g=(0,a.Uk)(", "),A=(0,a.Uk)("title"),k=(0,a.Uk)(", "),_=(0,a.Uk)("description"),F=(0,a.Uk)(", "),S=(0,a.Uk)("head"),x=(0,a.Uk)(" 和 "),U=(0,a.Uk)("locales"),R=(0,a.Uk)("。"),z=(0,a.uE)('<p>Client App Enhance 会在客户端应用创建后被调用，它可以为 Vue 应用添加任意功能。</p><div class="custom-container tip"><p class="custom-container-title">提示</p><p>为了方便用户配置使用， <code>.vuepress/clientAppEnhance.{js,ts}</code> 文件会被隐式地用作 Client App Enhance 文件，除非你在配置文件中显式设置了 <code>clientAppEnhanceFiles</code> 。</p></div><h2 id="注册-vue-组件" tabindex="-1"><a class="header-anchor" href="#注册-vue-组件" aria-hidden="true">#</a> 注册 Vue 组件</h2><p>你可以通过 <a href="https://v3.cn.vuejs.org/api/application-api.html#component" target="_blank" rel="noopener noreferrer">component</a> 方法来注册 Vue 全局组件：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> { </span><span style="color:#9CDCFE;">defineClientAppEnhance</span><span style="color:#D4D4D4;"> } </span><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;@vuepress/client&#39;</span></span>\n<span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">MyComponent</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;./MyComponent.vue&#39;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#C586C0;">export</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">default</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">defineClientAppEnhance</span><span style="color:#D4D4D4;">(({ </span><span style="color:#9CDCFE;">app</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">router</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">siteData</span><span style="color:#D4D4D4;"> }) </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span>\n<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">app</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">component</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;MyComponent&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">MyComponent</span><span style="color:#D4D4D4;">)</span></span>\n<span class="line"><span style="color:#D4D4D4;">})</span></span>\n<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="使用不支持-ssr-的功能" tabindex="-1"><a class="header-anchor" href="#使用不支持-ssr-的功能" aria-hidden="true">#</a> 使用不支持 SSR 的功能</h2><p>VuePress 会在构建过程中生成一个 SSR 应用，用以对页面进行预渲染。一般而言，如果一段代码在客户端应用 Mount 之前就使用了浏览器或 DOM API ，我们就认为其对 SSR 不友好，即不支持 SSR 。</p>',7),w=(0,a.Uk)("我们已经提供了一个 "),V=(0,a.Uk)("ClientOnly"),M=(0,a.Uk)(" 组件来包裹不支持 SSR 的内容。"),P=(0,a.Uk)("在 Client App Enhance 文件中，你可以使用 "),j=(0,a._)("code",null,"__VUEPRESS_SSR__",-1),W=(0,a.Uk)(" 标记来处理这种情况。"),O=(0,a.uE)('<div class="language-typescript ext-ts line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> { </span><span style="color:#9CDCFE;">defineClientAppEnhance</span><span style="color:#D4D4D4;"> } </span><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;@vuepress/client&#39;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#C586C0;">export</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">default</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">defineClientAppEnhance</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">async</span><span style="color:#D4D4D4;"> ({ </span><span style="color:#9CDCFE;">app</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">router</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">siteData</span><span style="color:#D4D4D4;"> }) </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span>\n<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (!</span><span style="color:#9CDCFE;">__VUEPRESS_SSR__</span><span style="color:#D4D4D4;">) {</span></span>\n<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> </span><span style="color:#4FC1FF;">nonSsrFriendlyModule</span><span style="color:#D4D4D4;"> = </span><span style="color:#C586C0;">await</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">import</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;non-ssr-friendly-module&#39;</span><span style="color:#D4D4D4;">)</span></span>\n<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">// ...</span></span>\n<span class="line"><span style="color:#D4D4D4;">  }</span></span>\n<span class="line"><span style="color:#D4D4D4;">})</span></span>\n<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="使用-router-方法" tabindex="-1"><a class="header-anchor" href="#使用-router-方法" aria-hidden="true">#</a> 使用 Router 方法</h2><p>你可以使用 vue-router 提供的 <a href="https://next.router.vuejs.org/zh/api/index.html#router-%E6%96%B9%E6%B3%95" target="_blank" rel="noopener noreferrer">Router 方法</a> 。例如，添加导航钩子：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> { </span><span style="color:#9CDCFE;">defineClientAppEnhance</span><span style="color:#D4D4D4;"> } </span><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;@vuepress/client&#39;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#C586C0;">export</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">default</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">defineClientAppEnhance</span><span style="color:#D4D4D4;">(({ </span><span style="color:#9CDCFE;">app</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">router</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">siteData</span><span style="color:#D4D4D4;"> }) </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span>\n<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">router</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">beforeEach</span><span style="color:#D4D4D4;">((</span><span style="color:#9CDCFE;">to</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span>\n<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">console</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">log</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;before navigation&#39;</span><span style="color:#D4D4D4;">)</span></span>\n<span class="line"><span style="color:#D4D4D4;">  })</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">router</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">afterEach</span><span style="color:#D4D4D4;">((</span><span style="color:#9CDCFE;">to</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span>\n<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">console</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">log</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;after navigation&#39;</span><span style="color:#D4D4D4;">)</span></span>\n<span class="line"><span style="color:#D4D4D4;">  })</span></span>\n<span class="line"><span style="color:#D4D4D4;">})</span></span>\n<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="custom-container warning"><p class="custom-container-title">注意</p><p>我们不推荐使用 <code>addRoute</code> 方法来添加动态路由，因为这些路由记录 <strong>不会</strong> 在构建模式中被预渲染出来。</p><p>当然，如果你了解了这种用法的缺点，你还是可以这样使用。</p></div>',5),H={},I=(0,e(83744).Z)(H,[["render",function(n,s){const e=(0,a.up)("RouterLink");return(0,a.wg)(),(0,a.iD)(a.HY,null,[p,(0,a._)("p",null,[l,(0,a.Wm)(e,{to:"/zh/vuepress-next/reference/plugin-api.html#clientappenhancefiles"},{default:(0,a.w5)((()=>[o])),_:1}),t]),r,(0,a._)("p",null,[c,i,D,(0,a.Wm)(e,{to:"/zh/vuepress-next/reference/client-api.html#defineclientappenhance"},{default:(0,a.w5)((()=>[u])),_:1}),y]),C,(0,a._)("ul",null,[d,h,(0,a._)("li",null,[m,f,(0,a.Wm)(e,{to:"/zh/vuepress-next/reference/config.html#base"},{default:(0,a.w5)((()=>[E])),_:1}),b,(0,a.Wm)(e,{to:"/zh/vuepress-next/reference/config.html#lang"},{default:(0,a.w5)((()=>[v])),_:1}),g,(0,a.Wm)(e,{to:"/zh/vuepress-next/reference/config.html#title"},{default:(0,a.w5)((()=>[A])),_:1}),k,(0,a.Wm)(e,{to:"/zh/vuepress-next/reference/config.html#description"},{default:(0,a.w5)((()=>[_])),_:1}),F,(0,a.Wm)(e,{to:"/zh/vuepress-next/reference/config.html#head"},{default:(0,a.w5)((()=>[S])),_:1}),x,(0,a.Wm)(e,{to:"/zh/vuepress-next/reference/config.html#locales"},{default:(0,a.w5)((()=>[U])),_:1}),R])]),z,(0,a._)("p",null,[w,(0,a.Wm)(e,{to:"/zh/vuepress-next/reference/components.html#clientonly"},{default:(0,a.w5)((()=>[V])),_:1}),M]),(0,a._)("p",null,[P,(0,a.Wm)(e,{to:"/zh/vuepress-next/reference/client-api.html#ssr"},{default:(0,a.w5)((()=>[j])),_:1}),W]),O],64)}]])}}]);